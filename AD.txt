Cброс пароля https://lifehacker.ru/sbros-parolya-windows-10/
при помощи проги https://www.youtube.com/watch?v=InHQYaLRHvc
Если локальный аккаунт заблочен https://www.youtube.com/watch?v=YR4nPiFRl18
                
                ОДНОРАНГОВАЯ СЕТЬ

    mstsc - RDP
    lusrmgr.msc - сменить имя локального пользователя на текущей машине
    sysdm.cpl - сменить размер файла подкачки 
    gpedit.msc - локальные политики (в system32)
    Мой компьютер - ПКМ Управление - пользователи (тут можно создать или удалить пользователя)
    ncpa.cpl - открыть сетевое окружение
    ipconfig - посмотреть свой ip
    ipconfig /release - освободить свой ip
    ipconfig /renew - запросить ipconfig
    ipconfig /flushdns - сбрость кэш DNS

    Полезное:

При переименовывании уже созданного пользователя папка, находящеяся в c/users остается не переименнованной. Надо имть это ввиду.
Если пользователя удалить, то останется его папка, и чтобы почистить всю инфу о нем, надо нажвть Мой комп ПКМ - advance system settings - user profiles

Включить встроенную учетку (Панель управления \ Администрирование \ Управление компьютером \ Локальные пользователи \ Пользователи \ ПКМ \ свойства \ отключенная учетная запись \ Задать пароль)
- включить учетку админа со стрелочкой вниз и задать ей пароль


Переименовываем учетку админа (Пуск \ Панель управления \ Administrative tools \ Локальная политика безопасности \ Локальные политики \ Параметры безопасности \ Учетные записи: Переименование учетной записи администратора \ adminic);
- для повышения секьюрности

Запретить отображение учетных записей (Пуск \ Панель управления \ Администрирование \ Локальная политика безопасности \ Локальные политики \ Параметры безопасности \ Интерактивный вход в систему: Не отображать последнее имя пользователя \ включен);
                              Не отображать имя пользователя при входе

gpedit.msc \ Конфигурация компьютера \ Административные шаблоны \ Компоненты Windows \ Пользовательский интерфейс учетных данных \ Отображать учетные записи администратора при повышении уровня прав \ Отключено                              

Требовать нажатия Ctrl+Alt+Del (Пуск \ Панель управления \ Администрирование \ Локальная политика безопасности \ Локальные политики \ Параметры безопасности \ Интерактивный вход в систему: Не требовать нажатия ctrl+alt+del \ отключен, т.е. требовать нажатия ctrl+alt+del);

Запретить вход в систему (Пуск \ Панель управления \ Администрирование \ Локальная политика безопасности \ Локальные политики \ Назначение прав пользователя \ Запретить локальный вход \ Добавить пользователя или группу \ Дополнительно \ Поиск \ office \ ОК \ ОК)

Лишить админских прав рабочие учетные записи (ПКМ \ Мой компьютер \ Управление компьютером \ Локальные пользователи и группы \ Администраторы)



    Более продвинутая система расшарвания ресурсов, это создания на какой либо машмне папки Файловый сервер и настройки ее и подпапок в ней. Но единовременно не может подключится более 20 пользователей (сессий)

Файловый сервер \ ПКМ \ Свойства \ Доступ \ Общий доступ \ Все \ Чтение и запись \ Поделиться 

Файловый сервер \ ПКМ \ Безопасность \ Все \ Дополнительно \ Все \ Изменить \ Применяется к: Только для этой папки

В итоге, теперь мы Разрешили полный доступ через настройку доступа, но запретили через настройку NTFS и теперь через NTFS будем настраивать уникальные права для папок.

Обмен (Безопасность \ Изменить \ Добавить \ Все \ Полный доступ)

Отдел продаж (Безопасность \ Изменить \ Economist \ Удалить \ Добавить \ Manager \ Полный доступ \ ОК)

Бухгалтерия (Безопасность \ Изменить \ Добавить \ Buhgalter \ Полный доступ \ ОК)

Документы (Безопасность \ Изменить \ Добавить \ все \ Только чтение и можно добавить сотрудника, который сможет добавлять сюда файлы)

                            Установка WIN11

Если устанавливаешь WIN11 на виртуалку, то там мин требования 2х ядерный проц (надо ставить), чип TPM 2.0, 4гб RAM, UEFI + secure boot. Но все кроме проца можно обойти, для этого в меню выбора версии ОС нажать SHIFT+F10, gedit, откроется редактор реестра.

Shift+F10 \ regedit \ HKEY_LOCAL_MACHINE\SYSTEM\Setup \ ПКМ \ Создать new key \ Раздел \ LabConfig \ ПКМ \ Создать \ Параметр DWORD (32-bit) со значениями 1:
BypassTPMCheck – отключение проверки чипа
BypassSecureBootCheck – отключение проверки защищенной загрузки
BypassRAMCheck – отключение проверки объема оперативной памяти

Так же при установки WIN11 отрубить инет, иначе не даст создать локального пользователя.
И при попытке подклюсится нажать SHIFT+F10 и ввести OOBE\BYPASSNRO


Если настриваешь одноранговую сеть, то иногда надо сменить WORKGROUP на другую, так как по умолчанию она тупит и не забыть отключить общий лоступ с парольной защитой. Расшарить папку на всех и дать необходимые права.
Чтобы повысить безопасность можно не отключать общий доступ с парольной защитой, а создать одного одинакового пользователя с паролем  на всех компах в рабочей группе и расшарить папку только для него. Таким образом если кто-либо подключитя к рабочей группе, то он не сможет зайти в расшареную директорию, так как не будет знать имя и пароль.

Чтобы изменить пароль, запомненный для входа на сервер надо на рабочей станции зайти в Панель управления - юзеры - администрирование учетных записей.            
            
            
                    ACTIVE DIRECTORY


            Первоначальная установка и настройка AD
После установки нужно:
- в настройках сети (в трее network ans sharing center - ethernet0 - properties) поставить статический ip адрес (а не полученный от роутепа по DHCP) , маску и DNS замкнуть на себя (127.0.0.1)
- изменить имя компа (RMB my comp - properties)
- установить AD domain services
- В окошке после установки нажать Promote this server to a domain controller, создать новый лес (office.loc), далее далее и перезагрузка
- tools - DNS - создать запись для Reverse lookup zones


                Подключение рабочей станции к домену 
- настроить ip адрес на рабочих станциях, без шлюза,  с DNS - наш контроллер домена
- рабочие станции надо переименовать адекватно (например по должности сотрудника, а не по имени), так как если сотрудник уволится, то новый сотрудник будет сидеть за компом с именем старого сотрудника, а смена имени может повлечь проблемы.
- указать пункт "является членом домена" - office.loc в нашем примере
- появится окошко, надо ввсети пароль админа, для присоединения к домену

На сервере
- проверить присоединены ли компы к домену (tools - AD users and computers - computers)


                        Создание пользователей
Tools - AD Users and Accounts - выбрать свой домен - users - New -user
Лучше имя для входа делать общее в виде должности, чтобы после увольнения поменять только ФИО.

Как сменить политику паролей
Tools - Group policy management - Domains - office.loc - Default Domain Poicies - 
вкладка settings 
RMB - edit 
Computer conf - Policies - Windows settings - Security settings - Account policies - Password Policy
После изменений нужно обновить групповую политику командой gpupdate, или перегрузить сервер
Остановить обновления -диспетчер задач - службы - открыть службы - Windows Update (остановить и отключить)

                            Принтеры
После установки принтера надо зати в Панель управления - принтеры - выбрат свой принтер и нажать Свойстава принтера (не просто Свойства)
Во вкладке Sharing надо расшарить этот принтер и включить его в AD
Во вкладке Security разрешть все всем, чтобы в случае проблем с принтером любой пользователь мог отменить печать или подобное

Данный принтер появится во вкладке сеть у всех пользователей домена
Или на компе пользователя зайти в control panel - принтеры - добавить принтер - 

                            DHCP-сервер
Manage - add roles and feature - DHCP server - в конце установки появляется - настроить (далее.далее) 
После установки: Tools - DHCP - IPV4 (new scope)
После смены ip надо проверить на сервере в tools -dhcp какие адреса lease
И проверить в DNS обратную запись, если не обновилась, тогда открыть прямую запись и поставить галочку Update PTR record 


                            ЧТобы раздать интернет
Нужна вторая сетевая карта
Нужно установить службу Manage - add roles - Remote Access (это NAT и тд)
И далее выбрать Routing
Далее Tools - Routing and remote Access - выбрать свой сервер и  настроить

                            Групповая политика (ярлык)
Tools - Group policy managment - Default Domain Policy - Settings - ПКМ edit - User config - Preferences - Windows settings - Shortcuts

ВАЖНО:
- после настройки AD или до настройки нужно лишить дефолтного юзера на рабочих станциях админских прав но !!! сначала переименовать и включить дефолтную запись  админа, чтоюы можно было зайти на машину, если не работает контроллер домена

                            Группы (локальная, глобальная, универсальная)

Создаем глобальную группу безопасности и ставим членов группы

                            Создание сайта
Установить в ролях IIS сервер, добавить сайт в папку, прописать на DNS контроллера домена A запись

https://whatcms.org/ - определить движок сайта
similarweb.com - посмотреть траффик сайта, посещения и др статистику


                        Создание структуры организации (Unit)

AD Users and comp - domen - new Organization Unit (галочка на Protect object from accidental deletio)
Чтобы убрать галочку и удалить надо зайти в View - Advance features - выбрать юнит - свойства - Object (тут будет галочка)

Чтобы создать юзера, который сможет управлять как админ компами внутри данной организационной единицы нужно (чтобы например другой сисадмин из другого города мог управлять соим филиалом):
Нажать ПКМ на юните и Delegate control

Далее перетащить компы и пользователей в соответствующие юниты

К пользователям и компам могут применятся 2 типа политик : 
- локальные (во всех виндовс) - gpedit.msc
- доменные (только в AD) - Tools - group policy management - ... - Default domen policy

Создание новой гупповой политики: Group policy objects - ПКМ - new

        Предпочтения групповых политик

Переименовываем созданную на пред этапе политику так как нам надо, чтобы в будущем было понятно за что она отвечает. Мы хотим добавить на раб стол несколько значков. За них отвечают данные параметры реестра (программа regshoot)

[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel]
"{59031a47-3f72-44a7-89c5-5595fe6b30ee}"=dword:00000000 - документы пользователя отображаются
"{20D04FE0-3AEA-1069-A2D8-08002B30309D}"=dword:00000000 - мой компьютер отображается
"{F02C1A0D-BE21-4350-88B0-7367FC96EF3C}"=dword:00000000 - сеть отобржается
"{5399E694-6CE5-4D6C-8FCE-1D8870FDCBA0}"=dword:00000000 - панель управления отображается

ПКМ - изменить
User configuration - Preferences - Windows settings - REgistry - ПКМ - new - registry item

Не забываем что есть targeting
Далее надо применить эту политику к домену
ПКМ на домене - Link an Existing GPO и выбрать нашу созданную политику

Так как если нажаьб ПКМ на новую политику и перейти на вкладку settings, то будет задействована только User Configuration, а Computer configuration - стоит No settings define, поэтому ее можно и нужно отключить, чтобы при применении данной политики комп не нагржался лишний раз


        Моделирование и результирующий набор политик

Моделирование
GPM - group policy modeling
Выбираем пользователя к которому будут применятся политики и на каком компе это будет - и таким образом она показывает какие политики будут применятся к этому пользователю на этом компе

Результирующя политика (Group policy resalts)
Показывает какие политики уже применены
Для того чтобы данная хрень работала надо добавить WMI (windows managment instrumentation) в исключения брандмауэра на той машине, на которой будем смотреть эту результирующую политику:
Панель управления - брандмауэр - вверху пункт Разрешить...

                Настройки брандмауэра

GPO - свой домен - create gpo and link
Edit - computer - policies - admin templates - network - network connections - firewall - domain profile - но тут мало пурктов настройки и они стандартные

... - policies - windows settings - secyrity settings - windows firewall with advance security - Inbound - ПКМ - create rule - 
Выбрать пункт predifined и там уже WMI (это для показа результирующей политики )

                Фильтры безопасмности и WMI

Можно использовать чтобы сначала применить политику не ко всем компам в домене и OU, а к какому то одному и потом уже, проверив что все хорошо, к остальным
ко ВСЕМ - ЭТО прошедште проверку

Создаем политику (вместо прошедших проверку добавляем компы и юзеров) и потом создвем фильтр WMI
Затем в политикке - scope - добавляем фильтр и связываем политику с доменом

                Общие сетевые ресурсы

Создаем папку на сервере которая в которую будем складывать все ярлыки для отображения на рабочих станциях
Создаем там папку Обмен
Создаем ярлык для программы (2гис), но путь до исполняемого файла должен быть сетевой и папка с установленной программой расшарена для чтения для Everyone!
Создаем политику и создаем папку на диске c (путь обычный)
Создаем ярлыки в этой папке, которые ссылаются на сетевой путь

            Скрипты

Создвем политику - comp config - policies - windows settings - scripts - show files - тут должны лежать фалы скриптов - выбрать нужный скрипт нажав add

            Удаленный рабочий стол

Создаем политику компа - policies - adm templtes - win components - RDP services - RDP session host - connections
Тут вкл параметр Aloow user to connect remoutly using RDP
- security
ТУт Allow user autentication .... (disable)

Далее открыть порт в брандмауэре
Тоже политика компа - policies - adm templates - network - net connections - win firewall - domain profile 
Тут вкл Allow inbound RDP exceptions
Слева можно указать с каких ip разрешено подключение. * - с любых

Далее откоючаем спящий режим
Тоже политика компа - policies - adm templates - system - power management - sleep settings
Тут вкл specify the system sleep timeout (plugged in) - 0
И specify the unattended sleep timeout (plugged in) - 0

        УДАЛЕННЫЙ ПОМОЩНИК (нет на сервере!)

Выполнить: msra - удаленный помощник
Тот кому надо помощь создает файл приглашения и помещает ее в общую папку или отправить по интернету + сообщает код доступа
ТО кто помогает открвает приглашение, вводит код и может видеть рабочий стол, чтоюы управлять надо отправить еще один запрос

Пользоваться данной штукой можно без создания файла приглашения, но только по локальной сети!
GPO - COmputer - policies - adm templates - system - remote assistance
COnfigure solicited remote assistance
COnfigure offer remote assistance - enable и указать кто может (office\Administrator)

Теперь с рабочей станции (не с сервера) можно нажать RUN и msra /offerra (с того пользователя который разрешен в политиках)
Можно скопировать данную команду и создать ярлык
Прога  BGinfo для отображения инфы о компе на рабочем столе 


            Принтеры

Создать групповые политики для каждого Organization Unit
Устанавлиаем сетевые принтеры на сервере или локальные на компах
В каждую политику принтера, созданную ранее comp - policies - wind settings - deploy printer - добавляем все принтеры в отделе (через сеть) 
Если принтер установлен не на сервере, а на локальной машине, то выбираем через сеть его.
Если компьютер перемещается в другой отдел, то надо просто его перекинт внутри active directory  в соответствующий юнит. Чтобы удалить принт надо удалить его из групповой политики, а не удалять групповую политику.

         Установка MSI (microsoft installation) программ

На каждую прогу делаем свою отдельную политику!
На примере LightManager
Устанавливаем клиент на сервер
ОТкрывааем программу, выбираем сверху сделать пакет MSI и выбираем файл server, вносим настройки (пароль) и закрывем
Делаем GPO
Comp - policies - software settings - software installation - new package - выбираем свой пакет который должен лежать в шаре, а именно лучше по пути из GPO (Comp - windows settings - scripts - startup), так как этот путь 100% доступен
Так же надо открыть порт в брандмауэре - comp - policies - wind settings - security settings - windows firewall with advanced security - wind firewall - inbound 
Теперь нужно включить режим инициализации сети при входе в систему 
Comp - policies - adm templates - system - logon - always wait for the network
Надо перегрузить комп 2 раза

            Установка  exe программ 

На каждую прогу делаем свою отдельную политику!
Надо устанавливать программу в тихом режиме
Например в WinRAR это делается через скрипт WinRAR.exe /s, помещенный в папку с файлом экзешником
Создаем GPO
Comp - Win settings - Scripts - Startup - копируем в папку экзешник и создаем скрипт

            Удаление программ через командную строку
- WMIC        
Запускать cmd надо от имени админа
wmic - утилита для удаления программ через cmd
Сначала выполнить - wmic
Затем выполнить - produc get name и отобразятся все утилиты которые видит прога
product where name="название_проги" call uninstall /nointeractive
WMIC видит не все программы, поэтому есть способ удаления через реестр

- РЕЕСТР 
Запускаем regedit
HKEY_LOCAL_MACHINE - SOFTWARE - Microsoft - Windows - Current version - Uninstall
Тут находятся все установленные проги 
Файл - найти (название проги) - это укажет ветку 
Надо найти строку UninstallString, тут указана команда для удаления 
параметр /q /X - q тихая , X - удаление
Вводим данную команду с параметрами в CMD и прога удаляется

Может быть указана не команда, а просто путь к файлу uninstall.exe

        Удаление через GPO

Если устанавливали через MSI пакет, то проще всего удалить указав в GPO, выбрать эту программу в политике software installation и нажать remove

Если через exe, то в реестре найти как удалять (команду или файл)
Открыть скрипты и сделать скрипт со строчкой на удаление, а тот скрипт который на установку убрать, например:
"%ProgramFiles%\WinRAR\uninstall.exe" /s - проценты используются для ввода переменной, так как в разных системах папка Program Files называется по разному

Все скрипты тестируем сначала на одном ПК (создаем контейнер TEST и юзер test и тестиуем)

        Подключение сетевого диска

GPM - Users - policies - win settings - drive maps - создать - действие: создать (вставить сетевой путь до папки, названиеб букву)

                                        РЕЗЕРВНОЕ КОПИРОВАНИЕ

RAID - апаратный 
В биосе выбрать пункт  RAID, перегрузиться, CTRL+i, выбрать диски , какой рейд использовать (зеркалирование RAID-1), какое название этого рейда. Диски форматируются.
В системе, после перезагрузки, его надо инициализировать.

RAID - программный
Встроенными средствами Виндовс 
diskmgmt.msc
Нажать на том диске, с которого будет делаться зеркало (инфа не удаляется)

Manage - add roles and features - features - windows server backup
Local backup - schedule

Изменить созданное расписание резервного копирования
Control panel -  administrative tools- Task scheduler
Тут можно изменить и выставить определенные дни 

Чтобы уоставлять нужное число копий, а лишние удалять, то в той же папке создаем новую задачу
Выполнять от пользователя System с галочкой высший приоритет
Из вкладки action задания на создания бэкапа копируем путь к команде и вставляем в новую задачу, но аргумент указаем лругой: 
delete backup -keepversions:2 -quiet

При выборе опции "архивации на диск", а не "на том", этот диск становится недоступен и не виден в системе и используется только для бэкапов


                Теневые копии 

My comp - manage - shared folder - all task - configure shadow 
Enable для диска папки на котором надо бэкапить
Settings (указать макс размер, и расписание)

Чтобы восстановить - выьираем диск - ПКМ - свойства - предыдущие версии - тут можно просмотреть и восстановить выборочно или все сразу


                Создание контрольных точек восстановения для рабочей станции

Мой комп - ПКМ - свойства - advance settings - system protection - выбираем диск и включить
Чтобы восстановить - Пуск - панель управления - восстановление

                Создание Бэкапа системного диска для рабочей станции

Пнель управления - Backup and restore win7 



                Core version

PowerShell

sconfig - команда для первоначальной настройки core сервера
работает комбинация CAD
shutdown /s - выключить сервер /r - перегрузить
powershall - запутить powershall (слева появятся буквы PS)
start powershall
stop-computer
restart-computer


hostname
ipconfig
cls - clear screen 
get-netadapter - инфа о адаптере
get-command -module команда - инфа о камандлетах и др обьетах 
get-command *команда*
get-command *set - какие начинаются с сет
get-command -noun net* - показывает только правую часть команды

Get-NetFirewallProfile - инфа о сотоянии каждого профиля файервола
Set-NetFirewallProfile -Profile domain -Enabled false - откобчить файервол на профиле доменном

        Integrated scripting environment

Enter-PSSession -ComputerName core_server - подключится к серверу 
Сперва подключаемся, потом можно отправлять другие команды скрипта, кроме ПЕРЕЗАГРУЗКИ

invoke-command -computername core_server команда - отправить одну команду на удаленный сервер

                Desired State Configuration (DSC)

Drift - изменение конфигурации оборудования со временем
MOV - файл PS для конфигурации 

                        DNS

ipconfig /flushdns - очистить локальный DNS кеш компа
Clear-DnsServerCache - очистить днс кеш сервера (если есть роль сервера)
Show-DnsServerCache
ipconfig /displaydns

просто Forwarder - все запросы обрабатывает данный днс сервер (можно указать роутер). Точнее запросы перенаправляются на этот адрес, если на локальном днс нет запрошенной инфы
Conditional forwarder - чтобы определенные запросы обрабатывал определенный днс сервер

Информация о рут серверах хранится на DNS сервере в папке C:\Windows\System32\dns
файл cache.dns
Show-DnsServerCache - посмотреть кеш сервера (даже если кеш очтстить, то они не удаляются)

Рекурсивный запрос - когда спросили и сразу получили ip адрес

Итеративный запрос - когда сначала образщаемся к рут, он присылает нам адрес сервера, ответственного за зону, мы обращаемся к нему, он присылает инфу о сервере ответственном за домен, мы обращаемся к нему, он нам уже сообщает адрес. Цепочка может быть боле длинной

                Записи DNS
A - соответсвтие имени адресу IPV4
AAAA - тоже но IP6

CNAME - можно создать псевдоним на основе своего домена и он может вообще ссылаться на любой сайт (yandex.it-primyshev.site ссылается на yandex.ru), или на свой же домен (используется для создания нескольких поддоменов типа etual.it-primyshev.site и test.it-primyshev.site)

NS - DNS сервер на котором находится запись о соответствии имени и ip нашего сайта (авторитетный сервер)
Обычно при покупке домена у того, кто продает этот домен есть и NS сервер, где ты настраиваешь свою запись. 
Если эта фирма не предоставляет услуги Name Servera, то надо купить у сторонней фирмы DNS сервис (нейм сервер) и уже на него в конечном счете приходят по цепочке (от рут сервера и тд) запросы и именно он отдат запись о соответствии имени сайта и сервера

PTR - переводит ip в название (обратная запись) нужна для безопаности, чтобы убедится, что данный ip действительно соответствует имени сайта или откуда пришло письмо

SRV - сервисные записи (показывает какие сервисы, протоколы и тд использует сервер)
TXT - просто текстовая запись (используют в основном для построения доверительных отношений между серверами)
SOA - содержит местоположение эталонной записи о домене

gcm *dns* - вывести все команды про DNS

